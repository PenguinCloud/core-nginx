---
- name: Create empty repo for certbot config file
  file:
    path: /etc/certbot/
    state: directory

- name: Template a file
  template:
    src: templates/certbot.j2
    dest: /etc/certbot/certbot.conf

- name: Run Certbot
  expect:
    command: certbot certonly --config /etc/certbot/certbot.conf
    responses:
      (?i)Are you OK with your IP being logged: "Yes"
  register: dnsinstructions
  ignore_errors: yes

- name: Add to your DNS the mentioned TXT record
  debug:
    var: dnsinstructions
- pause:
    prompt: "Hit enter once ready"

- name: Wait for DNS propogation
  pause:
    minutes: 2

- name: Run Certbot after adding DNS propogation
  expect:
    command: certbot certonly --config /etc/certbot/certbot.conf
    responses:
      (?i)Hit enter once ready: "enter"
  ignore_errors: yes

